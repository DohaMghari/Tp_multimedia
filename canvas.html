<!DOCTYPE html> 
<html lang="en">
<head>
 
</head>

<body>
        <video id="video" width="640" height="480" autoplay></video>
        <button id="snap">Capture Photo</button>
        <canvas id="canvas" width="640" height="480"></canvas>
        <div><label>Teinte</label><input type="range"  id="" min="0" onchange="refresh(this.value,'hue-rotate','deg')"
            max="360" step="3"></div>
        
        <div><label>Contraste</label><input type="range"  id="" min="0" onchange="refresh(this.value,'contrast','%')"
           max="360" step="3"></div>
        
        <div><label>Luminosit√©</label><input type="range"  id="" min="0" onchange="refresh(this.value,'brightness','%')"
            max="360" step="3"></div>
            <button  onclick='download_image()' >enregistrer</button>

        <script>
        var video = document.getElementById('video');


if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    
    navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
      
        video.srcObject = stream;
        video.play();
    });
}   
var video=document.querySelector('video');
  var canvas=document.querySelector('canvas');
  var context=canvas.getContext('2d');
  img = document.querySelector('video')
  var w,h,ratio;
  let value = 0;
 
document.getElementById("snap").addEventListener("click", function() {
    context.drawImage(video, 0, 0, 640, 480);
});
        

  video.addEventListener('loadedmetadata', function() {
    ratio = video.videoWidth/video.videoHeight;
    w = video.videoWidth-100;
    h = parseInt(w/ratio,10);
    canvas.width = w;
    canvas.height = h;
  },false);

  function snap() {
    context.fillRect(0,0,w,h);
    context.drawImage(video,0,0,w,h);
  }
  img = context.getImageData(0,0,w,h)
  

  function refresh(v,type,unite) {
        value = v
       draw(type,unite)
       console.log(value)
    }

    function draw(type,unite) {
        canvas.height = h;
        context.filter = type+'(' + value + unite+')'
        context.drawImage(img, 0, 0, w, h)
        const imageData = context.getImageData(0, 0, canvas.width, canvas.height),
        data = imageData.data
        for(let i=0; i<data.length; i+=4) {
            const r = data[i], g = data[i+1], b = data[i+2], a = data[i+3]
            
        }
        ctx.putImageData(imageData, 0, 0)
    }
    
    function download_image(){
        
        var base64=document.getElementById('canvas').toDataURL("image/png");
        var link = document.createElement('a');
        link.download = "my-image.png";
        link.href = base64;
        link.click();


}   
        </script>
        
</body>
</html>